<!DOCTYPE html>
<html>
<head>
    <title>City Oestrich Winkel</title>
    <style>
        /* Existing CSS */
        body {
            background-color: darkgreen;
            color: white;
            font-family: Arial, sans-serif;
            text-align: center;
        }
        .header {
            display: flex;
            justify-content: flex-start;
            padding: 10px;
        }
        .logo {
            margin-right: 20px;
        }
        .title {
            font-size: 24px;
            font-weight: bold;
            margin-top: 20px;
        }
        .form-container, .confirmation-container {
            margin-top: 20px;
            display: none; /* Hide both initially */
        }
        .form-container.active, .confirmation-container.active {
            display: inline-block; /* Show when active */
        }
        .form-field {
            margin-bottom: 10px;
        }
        .form-field label {
            display: block;
            margin-bottom: 5px;
        }
        .form-field input, .form-field button, .form-field select {
            width: 100%;
            padding: 8px;
        }
        .submit-container {
            text-align: right;
        }
        footer {
            margin-top: 30px;
            padding: 20px;
            text-align: center;
            font-size: 14px;
        }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/web3@1.3.0/dist/web3.min.js"></script>
</head>
<body>
    <div class="header">
        <img src="Oestrich.jpg" alt="City Oestrich Winkel Logo" class="logo">
    </div>
    
    <div class="title">Construction Application Form for Oestrich Winkel</div>

    <div class="form-container active" id="formSection">
        <form id="applicationForm">
            <!-- Form fields -->
            <!-- ... -->
            <div class="submit-container">
                <button type="submit">Submit Application</button>
            </div>
        </form>
    </div>

    <div class="confirmation-container" id="confirmationSection">
        <h2>Thank You for Your Registration</h2>
        <p>We will carefully review your request and get back to you shortly.</p>
        <p>Your Transaction Number: <span id="transactionNumber"></span></p>
    </div>

    <footer>
        Oestrich Winkel Department of Building and Safety
        <br>
        Contact Information: 0049 1739425126
        <br>
        <a href="https://www.oestrich-winkel.de/stadtverwaltung/buerger-service/" target="_blank">Website</a>
    </footer>

    <script>
        let web3;
        let contract;
        const contractAddress = '0xA698c8598b9837978CA480CD67451882E1928974';
        const contractABI = [ [
	{
		"inputs": [],
		"name": "confirmDocument1",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "confirmDocument2",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [],
		"stateMutability": "nonpayable",
		"type": "constructor"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": false,
				"internalType": "uint256",
				"name": "documentId",
				"type": "uint256"
			}
		],
		"name": "DocumentApproved",
		"type": "event"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": false,
				"internalType": "uint256",
				"name": "documentId",
				"type": "uint256"
			},
			{
				"indexed": false,
				"internalType": "address",
				"name": "byParty",
				"type": "address"
			}
		],
		"name": "DocumentUploaded",
		"type": "event"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": false,
				"internalType": "address",
				"name": "toParty",
				"type": "address"
			}
		],
		"name": "FundsReleased",
		"type": "event"
	},
	{
		"inputs": [],
		"name": "markTransactionPaidForDocument1",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "_party1",
				"type": "address"
			},
			{
				"internalType": "address",
				"name": "_party2",
				"type": "address"
			},
			{
				"internalType": "address",
				"name": "_thirdParty",
				"type": "address"
			}
		],
		"name": "setParties",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"anonymous": false,
		"inputs": [],
		"name": "TransactionMarkedPaid",
		"type": "event"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "_id",
				"type": "uint256"
			},
			{
				"internalType": "string",
				"name": "_password",
				"type": "string"
			}
		],
		"name": "uploadDocument1",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "_id",
				"type": "uint256"
			},
			{
				"internalType": "string",
				"name": "_password",
				"type": "string"
			}
		],
		"name": "uploadDocument2",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "document1",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "id",
				"type": "uint256"
			},
			{
				"internalType": "bytes32",
				"name": "passwordHash",
				"type": "bytes32"
			},
			{
				"internalType": "bool",
				"name": "isSubmitted",
				"type": "bool"
			},
			{
				"internalType": "bool",
				"name": "isApproved",
				"type": "bool"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "document2",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "id",
				"type": "uint256"
			},
			{
				"internalType": "bytes32",
				"name": "passwordHash",
				"type": "bytes32"
			},
			{
				"internalType": "bool",
				"name": "isSubmitted",
				"type": "bool"
			},
			{
				"internalType": "bool",
				"name": "isApproved",
				"type": "bool"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "fundsReleased",
		"outputs": [
			{
				"internalType": "bool",
				"name": "",
				"type": "bool"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "party1",
		"outputs": [
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "party2",
		"outputs": [
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "thirdParty",
		"outputs": [
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "transactionPaidForDocument1",
		"outputs": [
			{
				"internalType": "bool",
				"name": "",
				"type": "bool"
			}
		],
		"stateMutability": "view",
		"type": "function"
	}
] ];

        window.addEventListener('load', async () => {
            if (window.ethereum) {
                web3 = new Web3(window.ethereum);
                try {
                    await ethereum.request({ method: 'eth_requestAccounts' });
                    contract = new web3.eth.Contract(contractABI, contractAddress);
                } catch (error) {
                    console.error("User denied account access...");
                }
            } else if (window.web3) {
                web3 = new Web3(web3.currentProvider);
                contract = new web3.eth.Contract(contractABI, contractAddress);
            } else {
                console.log('Non-Ethereum browser detected. You should consider trying MetaMask!');
            }
        });

        document.getElementById('applicationForm').addEventListener('submit', async function(event) {
            event.preventDefault();
            const walletId = document.getElementById('walletId').value;
            // Extract other form values as needed

            try {
                const accounts = await web3.eth.getAccounts();
                await contract.methods.uploadDocument1(walletId, 'password').send({ from: accounts[0] });
                // Handle successful transaction
            } catch (error) {
                console.error("Error while uploading document:", error);
            }

            document.getElementById('formSection').classList.remove('active');
            document.getElementById('confirmationSection').classList.add('active');
            document.getElementById('transactionNumber').textContent = 'TXN-' + Math.floor(Math.random() * 1000000);
        });

document.getElementById('applicationForm').addEventListener('submit', async function(event) {
    event.preventDefault();
    console.log('Form submission initiated.');

    const walletId = document.getElementById('walletId').value;
    // Extract other form values as needed

    try {
        const accounts = await web3.eth.getAccounts();
        console.log('Sending transaction...');
        await contract.methods.uploadDocument1(walletId, 'password').send({ from: accounts[0] });
        console.log('Transaction sent.');
    } catch (error) {
        console.error("Error while uploading document:", error);
        return; // Exit the function if there's an error
    }

    // If all goes well, show the confirmation
    document.getElementById('formSection').classList.remove('active');
    document.getElementById('confirmationSection').classList.add('active');
    document.getElementById('confirmationSection').style.display = 'block'; // Ensure this is visible
    document.getElementById('transactionNumber').textContent = 'TXN-' + Math.floor(Math.random() * 1000000);
});

    </script>
</body>
</html>
